<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Materials Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #6a11cb;
            --secondary: #2575fc;
            --accent: #ff4d94;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --purple: #8e44ad;
            --orange: #e67e22;
            --teal: #1abc9c;
            --pink: #e84393;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Admin Panel Styles */
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 10002;
            overflow-y: auto;
        }

        .admin-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .admin-title {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .admin-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .admin-content {
            padding: 20px;
        }

        .admin-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .admin-section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .admin-form {
            display: grid;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-input {
            padding: 12px 15px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-select {
            padding: 12px 15px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            padding: 12px 15px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-file {
            padding: 10px;
            border: 2px dashed #e1e5eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .form-file:hover {
            border-color: var(--primary);
        }

        .form-submit {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 500;
        }

        .form-submit:hover {
            background: var(--secondary);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .admin-table th, .admin-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e1e5eb;
        }

        .admin-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }

        .admin-table tr:hover {
            background: #f8f9fa;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-right: 5px;
            transition: all 0.2s ease;
        }

        .action-edit {
            background: var(--warning);
            color: white;
        }

        .action-delete {
            background: var(--danger);
            color: white;
        }

        .action-btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        /* Login Form */
        .login-form {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .login-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.8rem;
        }

        /* Toast Message */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .toast.error {
            background: var(--danger);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Welcome Popup */
        .welcome-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.5s ease;
        }

        .popup-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: popIn 0.5s ease;
        }

        .popup-content h2 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 2rem;
        }

        .popup-content p {
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .developer-id {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            display: inline-block;
            margin: 10px 0;
        }

        .close-popup {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-popup:hover {
            background: var(--secondary);
            transform: translateY(-3px);
        }

        /* Page Source Protection */
        .source-protection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
        }

        .password-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .password-box h3 {
            color: var(--primary);
            margin-bottom: 20px;
        }

        .password-input {
            width: 100%;
            padding: 12px 15px;
            margin: 15px 0;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .password-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .password-submit {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }

        .password-submit:hover {
            background: var(--secondary);
        }

        .password-error {
            color: var(--danger);
            margin-top: 10px;
            display: none;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .device-notice {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            display: inline-block;
            font-size: 0.9rem;
        }

        /* Search */
        .search-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            position: relative;
        }

        .search-box {
            width: 70%;
            max-width: 500px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 1.2rem;
        }

        .admin-icon {
            position: absolute;
            right: -60px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-icon:hover {
            color: var(--secondary);
            transform: translateY(-50%) scale(1.1);
        }

        /* Sections */
        .section-title {
            font-size: 1.8rem;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            color: var(--dark);
            display: inline-block;
        }

        .pdf-grid, .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .pdf-card, .image-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .pdf-card:hover, .image-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .pdf-icon, .image-icon {
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3.5rem;
            position: relative;
            overflow: hidden;
        }

        .pdf-icon {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .image-icon {
            background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%);
        }

        .pdf-icon::after, .image-icon::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }

        .pdf-info, .image-info {
            padding: 20px;
        }

        .pdf-name, .image-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .pdf-actions, .image-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-view {
            background-color: var(--primary);
            color: white;
        }

        .btn-download {
            background-color: var(--secondary);
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        /* Routine Section */
        .routine-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .routine-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .routine-image {
            width: 100%;
            max-width: 800px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .routine-image:hover {
            transform: scale(1.02);
        }

        /* Viewer */
        .viewer-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            padding: 20px;
        }

        .viewer-content {
            background: white;
            width: 90%;
            height: 90%;
            margin: 2% auto;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: popIn 0.3s ease;
        }

        .viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--light);
            border-bottom: 1px solid #e1e5eb;
        }

        .viewer-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--primary);
            transition: transform 0.2s ease;
        }

        .close-btn:hover {
            transform: scale(1.2);
        }

        .pdf-frame {
            flex: 1;
            border: none;
        }

        .image-view {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: auto;
        }

        .full-image {
            max-width: 100%;
            max-height: 100%;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #666;
            display: none;
            grid-column: 1 / -1;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 30px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #e1e5eb;
        }

        .copyright {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* View More/Less Button */
        .view-more-btn {
            display: block;
            margin: 30px auto;
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .view-more-btn:hover {
            background: var(--secondary);
            transform: translateY(-3px);
        }

        /* Mini View for Mobile */
        .mini-view {
            display: none;
        }

        .mini-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .mini-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .mini-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .mini-info {
            flex: 1;
        }

        .mini-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .mini-actions {
            display: flex;
            gap: 10px;
        }

        .mini-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .pdf-grid, .image-grid {
                display: none;
            }
            
            .mini-view {
                display: block;
            }
            
            .search-box {
                width: 90%;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .pdf-actions, .image-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .device-notice {
                font-size: 0.8rem;
                padding: 8px;
            }
            
            .routine-image {
                max-width: 100%;
            }
            
            .mini-btn {
                font-size: 0.7rem;
                padding: 5px 8px;
            }
            
            .admin-icon {
                right: 0;
                top: 60px;
            }
        }

        @media (max-width: 480px) {
            .pdf-grid, .image-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .popup-content {
                padding: 20px;
            }
            
            .password-box {
                padding: 20px;
            }
        }

        /* Mobile Routine Popup */
        .mobile-routine-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1002;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .mobile-routine-content {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: popIn 0.3s ease;
        }

        .mobile-routine-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
        }

        .mobile-routine-body {
            padding: 20px;
            text-align: center;
        }

        .mobile-routine-image {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .mobile-routine-close {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
            transition: background 0.3s;
        }

        .mobile-routine-close:hover {
            background: var(--secondary);
        }

        /* Stats Section */
        .stats-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 30px 0;
            gap: 15px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            flex: 1;
            min-width: 150px;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Progress Bar */
        .progress-container {
            margin: 20px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .progress-bar {
            height: 8px;
            background: #e1e5eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Dark Mode Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background: linear-gradient(135deg, #121212 0%, #1e1e1e 100%);
            color: #f0f0f0;
        }

        body.dark-mode header {
            background: linear-gradient(135deg, #2d0b5a 0%, #0d2f6e 100%);
        }

        body.dark-mode .pdf-card,
        body.dark-mode .image-card,
        body.dark-mode .routine-container,
        body.dark-mode .stat-card,
        body.dark-mode .mini-card {
            background: #2d2d2d;
            color: #f0f0f0;
        }

        body.dark-mode .pdf-name,
        body.dark-mode .image-name,
        body.dark-mode .routine-title,
        body.dark-mode .section-title,
        body.dark-mode .mini-name {
            color: #f0f0f0;
        }

        body.dark-mode .search-input {
            background: #2d2d2d;
            color: #f0f0f0;
        }

        body.dark-mode footer {
            border-top: 1px solid #444;
            color: #aaa;
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--accent);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 99;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .fab:hover {
            transform: scale(1.1);
        }

        /* Quick Actions Menu */
        .quick-actions {
            position: fixed;
            bottom: 90px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 98;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .quick-actions.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .quick-action {
            background: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            transform: scale(1.1);
        }

        /* Subject Icons */
        .subject-icon {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <!-- Toast Message -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i> Download started
    </div>

    <!-- Welcome Popup -->
    <div class="welcome-popup" id="welcomePopup">
        <div class="popup-content">
            <h2>Welcome to Study Materials Portal</h2>
            <p>Access all your study materials, important questions, and semester routines in one place.</p>
            <div class="developer-id">Developer: 22MH1A0501</div>
            <p>Made by Abhishek</p>
            <button class="close-popup" id="closePopup">Get Started</button>
        </div>
    </div>

    <!-- Admin Login -->
    <div class="welcome-popup" id="adminLoginPopup">
        <div class="popup-content">
            <h2>Admin Login</h2>
            <div class="login-form">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="adminEmail" placeholder="Enter admin email">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="adminPassword" placeholder="Enter admin password">
                </div>
                <button class="form-submit" id="adminLoginBtn">Login</button>
                <p class="password-error" id="adminLoginError" style="margin-top: 10px;"></p>
            </div>
        </div>
    </div>

    <!-- Page Source Protection -->
    <div class="source-protection" id="sourceProtection">
        <div class="password-box">
            <h3>Page Source Protection</h3>
            <p>Enter password to view page source</p>
            <input type="password" class="password-input" id="passwordInput" placeholder="Enter password">
            <button class="password-submit" id="passwordSubmit">Submit</button>
            <p class="password-error" id="passwordError">Incorrect password. Please try again.</p>
        </div>
    </div>

    <!-- Mobile Routine Popup -->
    <div class="mobile-routine-popup" id="mobileRoutinePopup">
        <div class="mobile-routine-content">
            <div class="mobile-routine-header">
                <h3>Semester Routine</h3>
            </div>
            <div class="mobile-routine-body">
                <img src="sem.png" alt="Semester Routine" class="mobile-routine-image">
                <p>Your semester schedule at a glance</p>
                <button class="mobile-routine-close" id="mobileRoutineClose">Close</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <div class="admin-title">Admin Dashboard</div>
            <button class="admin-close" id="adminClose"><i class="fas fa-times"></i></button>
        </div>
        <div class="admin-content">
            <div class="admin-section">
                <h3 class="admin-section-title">Website Statistics</h3>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="adminTotalVisits">0</div>
                        <div class="stat-label">Total Visits</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="adminTotalPdfs">0</div>
                        <div class="stat-label">PDF Materials</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="adminTotalImpQuestions">0</div>
                        <div class="stat-label">Important Questions</div>
                    </div>
                </div>
            </div>
            
            <div class="admin-section">
                <h3 class="admin-section-title">Add New PDF</h3>
                <form class="admin-form" id="addPdfForm">
                    <div class="form-group">
                        <label class="form-label">PDF Name</label>
                        <input type="text" class="form-input" id="pdfName" placeholder="Enter PDF name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Display Name</label>
                        <input type="text" class="form-input" id="pdfDisplayName" placeholder="Enter display name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select class="form-select" id="pdfType" required>
                            <option value="material">Study Material</option>
                            <option value="imp-material">Important Question</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Subject Icon</label>
                        <select class="form-select" id="pdfIcon" required>
                            <option value="fa-laptop-code">Computer</option>
                            <option value="fa-shield-alt">Security</option>
                            <option value="fa-cloud">Cloud</option>
                            <option value="fa-heart">Values</option>
                            <option value="fa-code">Programming</option>
                            <option value="fa-briefcase">Business</option>
                            <option value="fa-project-diagram">Data Structures</option>
                            <option value="fa-database">Database</option>
                            <option value="fa-cogs">Operating System</option>
                            <option value="fa-robot">AI</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Color</label>
                        <input type="color" class="form-input" id="pdfColor" value="#6a11cb" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Upload PDF</label>
                        <input type="file" class="form-file" id="pdfFile" accept=".pdf" required>
                    </div>
                    <button type="submit" class="form-submit">Add PDF</button>
                </form>
            </div>
            
            <div class="admin-section">
                <h3 class="admin-section-title">Manage PDFs</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Date Added</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="pdfTableBody">
                        <!-- PDF rows will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Floating Action Button -->
    <div class="fab" id="fab">
        <i class="fas fa-plus"></i>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions" id="quickActions">
        <div class="quick-action" id="quickDownload" title="Download All">
            <i class="fas fa-download"></i>
        </div>
        <div class="quick-action" id="quickSearch" title="Search">
            <i class="fas fa-search"></i>
        </div>
        <div class="quick-action" id="quickRoutine" title="Routine">
            <i class="fas fa-calendar-alt"></i>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>Study Materials Portal</h1>
            <p class="subtitle">Access PDFs, Important Questions, Images, and Semester Routines</p>
            <div class="device-notice">
                <i class="fas fa-mobile-alt"></i> Optimized for mobile devices
            </div>
        </header>

        <!-- Search with Admin Icon -->
        <div class="search-container">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="Search PDF files, images, and more..." id="searchInput">
                <span class="search-icon"><i class="fas fa-search"></i></span>
            </div>
            <div class="admin-icon" id="adminIcon" title="Admin Login">
                <i class="fas fa-user-cog"></i>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value" id="totalPdfs">0</div>
                <div class="stat-label">PDF Materials</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalImpQuestions">0</div>
                <div class="stat-label">Important Questions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalImages">0</div>
                <div class="stat-label">Question Images</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">1</div>
                <div class="stat-label">Semester Routine</div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-label">
                <span>Study Progress</span>
                <span id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <!-- PDF Materials Section -->
        <h2 class="section-title">PDF Study Materials</h2>
        <div class="pdf-grid" id="pdfGrid">
            <!-- PDF cards will be dynamically generated here -->
        </div>

        <div class="mini-view" id="pdfMiniView">
            <!-- Mini PDF cards will be dynamically generated here -->
        </div>

        <button class="view-more-btn" id="viewMorePdfs">View More</button>

        <!-- Important Questions Section -->
        <h2 class="section-title">Important Questions</h2>
        <div class="pdf-grid" id="impPdfGrid">
            <!-- Important PDF cards will be dynamically generated here -->
        </div>

        <div class="mini-view" id="impPdfMiniView">
            <!-- Mini Important PDF cards will be dynamically generated here -->
        </div>

        <button class="view-more-btn" id="viewMoreImpPdfs">View More</button>

        <!-- Semester Routine Section -->
        <h2 class="section-title">Semester Routine</h2>
        <div class="routine-container">
            <div class="routine-title">Academic Schedule 2023-2024</div>
            <img src="sem.png" alt="Semester Routine" class="routine-image" id="routineImage">
            <div class="pdf-actions" style="margin-top: 15px; justify-content: center;">
                <button class="btn btn-download" id="downloadRoutine">
                    <i class="fas fa-download"></i> Download Routine
                </button>
            </div>
        </div>

        <div class="no-results" id="noResults">
            <i class="fas fa-search fa-2x" style="margin-bottom: 15px;"></i>
            <p>No items found matching your search.</p>
        </div>

        <!-- PDF Viewer -->
        <div class="viewer-container" id="pdfViewerContainer">
            <div class="viewer-content">
                <div class="viewer-header">
                    <div class="viewer-title" id="pdfViewerTitle">PDF Viewer</div>
                    <button class="close-btn" id="closePdfViewer"><i class="fas fa-times"></i></button>
                </div>
                <iframe class="pdf-frame" id="pdfFrame" src=""></iframe>
            </div>
        </div>

        <!-- Image Viewer -->
        <div class="viewer-container" id="imageViewerContainer">
            <div class="viewer-content">
                <div class="viewer-header">
                    <div class="viewer-title" id="imageViewerTitle">Image Viewer</div>
                    <button class="close-btn" id="closeImageViewer"><i class="fas fa-times"></i></button>
                </div>
                <div class="image-view">
                    <img src="" alt="Full size image" class="full-image" id="fullImage">
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="copyright">Copyright Â© Abhishek - 22MH1A0501</div>
        <p>Study Materials Portal - All rights reserved</p>
    </footer>

    <script>
     // Security: Disable right-click and text selection
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    showToast("Right-click is disabled");
});

document.addEventListener('selectstart', function(e) {
    e.preventDefault();
});

document.addEventListener('keydown', function(e) {
    // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
    if (e.key === 'F12' || 
        (e.ctrlKey && e.shiftKey && e.key === 'I') || 
        (e.ctrlKey && e.shiftKey && e.key === 'J') || 
        (e.ctrlKey && e.key === 'u')) {
        e.preventDefault();
        document.getElementById('sourceProtection').style.display = 'flex';
    }
});

// Page source protection
const sourceProtection = document.getElementById('sourceProtection');
const passwordInput = document.getElementById('passwordInput');
const passwordSubmit = document.getElementById('passwordSubmit');
const passwordError = document.getElementById('passwordError');

passwordSubmit.addEventListener('click', function() {
    if (passwordInput.value === '12345') {
        sourceProtection.style.display = 'none';
        passwordInput.value = '';
        passwordError.style.display = 'none';
    } else {
        passwordError.style.display = 'block';
        passwordInput.value = '';
    }
});

// Toast message function
function showToast(message, isError = false) {
    const toast = document.getElementById('toast');
    toast.innerHTML = isError ? 
        `<i class="fas fa-exclamation-circle"></i> ${message}` : 
        `<i class="fas fa-check-circle"></i> ${message}`;
    toast.className = isError ? 'toast error' : 'toast';
    toast.style.display = 'block';
    setTimeout(() => {
        toast.style.display = 'none';
    }, 3000);
}

// Global variables to store current PDFs from MongoDB
let currentMaterialPDFs = [];
let currentImpPDFs = [];

// DOM elements
const welcomePopup = document.getElementById('welcomePopup');
const adminLoginPopup = document.getElementById('adminLoginPopup');
const closePopup = document.getElementById('closePopup');
const adminIcon = document.getElementById('adminIcon');
const adminLoginBtn = document.getElementById('adminLoginBtn');
const adminEmail = document.getElementById('adminEmail');
const adminPassword = document.getElementById('adminPassword');
const adminLoginError = document.getElementById('adminLoginError');
const adminPanel = document.getElementById('adminPanel');
const adminClose = document.getElementById('adminClose');
const addPdfForm = document.getElementById('addPdfForm');
const pdfTableBody = document.getElementById('pdfTableBody');
const adminTotalVisits = document.getElementById('adminTotalVisits');
const adminTotalPdfs = document.getElementById('adminTotalPdfs');
const adminTotalImpQuestions = document.getElementById('adminTotalImpQuestions');
const pdfGrid = document.getElementById('pdfGrid');
const impPdfGrid = document.getElementById('impPdfGrid');
const pdfMiniView = document.getElementById('pdfMiniView');
const impPdfMiniView = document.getElementById('impPdfMiniView');
const searchInput = document.getElementById('searchInput');
const noResults = document.getElementById('noResults');
const pdfViewerContainer = document.getElementById('pdfViewerContainer');
const pdfFrame = document.getElementById('pdfFrame');
const pdfViewerTitle = document.getElementById('pdfViewerTitle');
const closePdfViewer = document.getElementById('closePdfViewer');
const imageViewerContainer = document.getElementById('imageViewerContainer');
const fullImage = document.getElementById('fullImage');
const imageViewerTitle = document.getElementById('imageViewerTitle');
const closeImageViewer = document.getElementById('closeImageViewer');
const routineImage = document.getElementById('routineImage');
const mobileRoutinePopup = document.getElementById('mobileRoutinePopup');
const mobileRoutineClose = document.getElementById('mobileRoutineClose');
const viewMorePdfsBtn = document.getElementById('viewMorePdfs');
const viewMoreImpPdfsBtn = document.getElementById('viewMoreImpPdfs');
const themeToggle = document.getElementById('themeToggle');
const fab = document.getElementById('fab');
const quickActions = document.getElementById('quickActions');
const quickDownload = document.getElementById('quickDownload');
const quickSearch = document.getElementById('quickSearch');
const quickRoutine = document.getElementById('quickRoutine');
const downloadRoutine = document.getElementById('downloadRoutine');
const totalPdfs = document.getElementById('totalPdfs');
const totalImpQuestions = document.getElementById('totalImpQuestions');
const totalImages = document.getElementById('totalImages');
const progressFill = document.getElementById('progressFill');
const progressPercent = document.getElementById('progressPercent');

// View More/Less state
let pdfsVisible = 6;
let impPdfsVisible = 6;

// Admin state
let isAdminLoggedIn = false;
let websiteVisits = localStorage.getItem('websiteVisits') ? parseInt(localStorage.getItem('websiteVisits')) : 0;

// ==================== DATABASE FUNCTIONS ====================

// Function to load PDFs from MongoDB
async function loadPDFsFromDatabase() {
    try {
        console.log('ðŸ”„ Loading PDFs from MongoDB...');
        
        // Load study materials
        const materialResponse = await fetch('/api/pdfs/material');
        if (!materialResponse.ok) throw new Error('Failed to fetch materials');
        currentMaterialPDFs = await materialResponse.json();
        
        // Load important questions  
        const impResponse = await fetch('/api/pdfs/imp-material');
        if (!impResponse.ok) throw new Error('Failed to fetch important questions');
        currentImpPDFs = await impResponse.json();
        
        console.log(`ðŸ“š Loaded ${currentMaterialPDFs.length} materials, ${currentImpPDFs.length} important PDFs`);
        
        // Update the UI with real data
        updatePDFsDisplay(currentMaterialPDFs, currentImpPDFs);
        updateStatsCounts();
        
    } catch (error) {
        console.error('Error loading PDFs from MongoDB:', error);
        showToast("Failed to load PDFs. Please refresh the page.", true);
        // Fallback to empty arrays
        currentMaterialPDFs = [];
        currentImpPDFs = [];
    }
}

// Function to update stats with real data from MongoDB
async function updateStatsCounts() {
    try {
        const response = await fetch('/api/stats/counts');
        if (!response.ok) throw new Error('Failed to fetch counts');
        const counts = await response.json();
        
        totalPdfs.textContent = counts.materialCount;
        totalImpQuestions.textContent = counts.impMaterialCount;
        totalImages.textContent = 0;
        
        console.log(`ðŸ“Š Updated stats: ${counts.materialCount} materials, ${counts.impMaterialCount} important`);
    } catch (error) {
        console.error('Error updating stats:', error);
        // Fallback to local counts
        totalPdfs.textContent = currentMaterialPDFs.length;
        totalImpQuestions.textContent = currentImpPDFs.length;
        totalImages.textContent = 0;
    }
}

// Function to update PDFs display
function updatePDFsDisplay(materialPDFs, impPDFs) {
    // Clear existing content
    pdfGrid.innerHTML = '';
    impPdfGrid.innerHTML = '';
    pdfMiniView.innerHTML = '';
    impPdfMiniView.innerHTML = '';
    
    // Render study materials
    renderPDFCards(materialPDFs, pdfGrid);
    renderPDFCards(materialPDFs, pdfMiniView, true);
    
    // Render important questions
    renderPDFCards(impPDFs, impPdfGrid);
    renderPDFCards(impPDFs, impPdfMiniView, true);
    
    // Update view more buttons
    updateViewMoreButtons();
    
    // Show no results if no PDFs
    if (materialPDFs.length === 0 && impPDFs.length === 0) {
        noResults.style.display = 'block';
    } else {
        noResults.style.display = 'none';
    }
}

// ==================== ADMIN FUNCTIONS ====================

// Admin login
adminLoginBtn.addEventListener('click', function() {
    const email = adminEmail.value;
    const password = adminPassword.value;
    
    if (email === 'a@gmail.com' && password === '12345') {
        isAdminLoggedIn = true;
        adminLoginPopup.style.display = 'none';
        adminPanel.style.display = 'block';
        document.querySelector('.container').style.display = 'none';
        document.querySelector('footer').style.display = 'none';
        showToast("Admin login successful");
        updateAdminStats();
        renderPdfTable();
    } else {
        adminLoginError.textContent = "Invalid email or password";
        adminLoginError.style.display = 'block';
    }
});

// Close admin panel
adminClose.addEventListener('click', function() {
    adminPanel.style.display = 'none';
    document.querySelector('.container').style.display = 'block';
    document.querySelector('footer').style.display = 'block';
    isAdminLoggedIn = false;
});

// Update admin stats
function updateAdminStats() {
    adminTotalVisits.textContent = websiteVisits;
    adminTotalPdfs.textContent = currentMaterialPDFs.length;
    adminTotalImpQuestions.textContent = currentImpPDFs.length;
}

// Render PDF table in admin panel
async function renderPdfTable() {
    try {
        const response = await fetch('/api/pdfs');
        if (!response.ok) throw new Error('Failed to fetch PDFs for admin');
        const allPdfs = await response.json();
        
        pdfTableBody.innerHTML = '';
        
        allPdfs.forEach(pdf => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${pdf.displayName}</td>
                <td>${pdf.type === 'material' ? 'Study Material' : 'Important Question'}</td>
                <td>${new Date(pdf.dateAdded).toLocaleDateString()}</td>
                <td>
                    <button class="action-btn action-delete" data-id="${pdf._id}">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </td>
            `;
            pdfTableBody.appendChild(row);
        });
        
        // Add event listeners for delete buttons
        document.querySelectorAll('.action-delete').forEach(btn => {
            btn.addEventListener('click', function() {
                const id = this.getAttribute('data-id');
                deletePdf(id);
            });
        });
    } catch (error) {
        console.error('Error rendering PDF table:', error);
        pdfTableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #666;">Failed to load PDFs</td></tr>';
    }
}

// Delete PDF from MongoDB
async function deletePdf(id) {
    if (confirm("Are you sure you want to delete this PDF?")) {
        try {
            const response = await fetch(`/api/admin/pdfs/${id}`, {
                method: 'DELETE'
            });
            
            if (response.ok) {
                // Reload PDFs from database
                await loadPDFsFromDatabase();
                renderPdfTable();
                updateAdminStats();
                
                showToast("PDF deleted successfully");
            } else {
                const error = await response.json();
                showToast(error.error || "Failed to delete PDF", true);
            }
        } catch (error) {
            console.error('Error deleting PDF:', error);
            showToast("Failed to delete PDF", true);
        }
    }
}

// Admin PDF Upload
addPdfForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const pdfName = document.getElementById('pdfName').value;
    const pdfDisplayName = document.getElementById('pdfDisplayName').value;
    const pdfType = document.getElementById('pdfType').value;
    const pdfIcon = document.getElementById('pdfIcon').value;
    const pdfColor = document.getElementById('pdfColor').value;
    const pdfFile = document.getElementById('pdfFile').files[0];
    
    if (!pdfFile) {
        showToast("Please select a PDF file", true);
        return;
    }
    
    // Create form data for file upload
    const formData = new FormData();
    formData.append('pdfFile', pdfFile);
    formData.append('pdfName', pdfName);
    formData.append('pdfDisplayName', pdfDisplayName);
    formData.append('pdfType', pdfType);
    formData.append('pdfIcon', pdfIcon);
    formData.append('pdfColor', pdfColor);

    // Show loading
    const submitBtn = addPdfForm.querySelector('.form-submit');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
    submitBtn.disabled = true;

    try {
        const response = await fetch('/api/admin/pdfs', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (response.ok && result.success) {
            // Reset form
            addPdfForm.reset();
            
            // Reload PDFs from database
            await loadPDFsFromDatabase();
            renderPdfTable();
            updateAdminStats();
            
            showToast("PDF added successfully!");
        } else {
            showToast(result.error || "Failed to add PDF", true);
        }
    } catch (error) {
        console.error('Error adding PDF:', error);
        showToast("Failed to add PDF: " + error.message, true);
    } finally {
        // Reset button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});

// ==================== UI RENDERING FUNCTIONS ====================

// Function to render PDF cards
function renderPDFCards(pdfs, container, isMini = false) {
    container.innerHTML = '';
    
    if (pdfs.length === 0) {
        const emptyMsg = document.createElement('div');
        emptyMsg.className = 'no-results';
        emptyMsg.innerHTML = `
            <i class="fas fa-file-pdf fa-2x" style="margin-bottom: 15px;"></i>
            <p>No PDFs available yet</p>
        `;
        container.appendChild(emptyMsg);
        return;
    }
    
    const itemsToShow = isMini ? pdfs.slice(0, pdfsVisible) : pdfs;
    
    itemsToShow.forEach(pdf => {
        if (isMini) {
            const card = document.createElement('div');
            card.className = 'mini-card';
            card.innerHTML = `
                <div class="mini-icon" style="background: ${pdf.color}">
                    <i class="fas ${pdf.icon}"></i>
                </div>
                <div class="mini-info">
                    <div class="mini-name">${pdf.displayName}</div>
                    <div class="mini-actions">
                        <button class="mini-btn btn-view" data-id="${pdf._id}" data-type="${pdf.type}">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="mini-btn btn-download" data-id="${pdf._id}" data-type="${pdf.type}">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(card);
        } else {
            const card = document.createElement('div');
            card.className = 'pdf-card';
            card.innerHTML = `
                <div class="pdf-icon" style="background: linear-gradient(135deg, ${pdf.color} 0%, ${adjustColor(pdf.color, 20)} 100%)">
                    <i class="fas ${pdf.icon}"></i>
                    <div class="subject-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                </div>
                <div class="pdf-info">
                    <div class="pdf-name">${pdf.displayName}</div>
                    <div class="pdf-actions">
                        <button class="btn btn-view" data-id="${pdf._id}" data-type="${pdf.type}">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn btn-download" data-id="${pdf._id}" data-type="${pdf.type}">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(card);
        }
    });
}

// Helper function to adjust color brightness
function adjustColor(color, percent) {
    const num = parseInt(color.replace("#", ""), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) + amt;
    const G = (num >> 8 & 0x00FF) + amt;
    const B = (num & 0x0000FF) + amt;
    return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
}

// Update view more buttons based on data
function updateViewMoreButtons() {
    if (currentMaterialPDFs.length <= 6) {
        viewMorePdfsBtn.style.display = 'none';
    } else {
        viewMorePdfsBtn.style.display = 'block';
    }
    
    if (currentImpPDFs.length <= 6) {
        viewMoreImpPdfsBtn.style.display = 'none';
    } else {
        viewMoreImpPdfsBtn.style.display = 'block';
    }
}

// ==================== PDF VIEWER & DOWNLOAD FUNCTIONS ====================

// Function to open PDF viewer
function openPDFViewer(pdfId, type) {
    let pdf;
    if (type === 'material') {
        pdf = currentMaterialPDFs.find(p => p._id == pdfId);
    } else {
        pdf = currentImpPDFs.find(p => p._id == pdfId);
    }
    
    if (pdf) {
        pdfViewerTitle.textContent = pdf.displayName;
        // Serve PDF from server
        pdfFrame.src = pdf.path;
        pdfViewerContainer.style.display = 'block';
    }
}

// Function to download PDF
function downloadPDF(pdfId, type) {
    let pdf;
    if (type === 'material') {
        pdf = currentMaterialPDFs.find(p => p._id == pdfId);
    } else {
        pdf = currentImpPDFs.find(p => p._id == pdfId);
    }
    
    if (pdf) {
        // Create download link to server file
        const link = document.createElement('a');
        link.href = pdf.path;
        link.download = pdf.name || pdf.displayName + '.pdf';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showToast(`${pdf.displayName} downloaded successfully`);
    }
}

// ==================== SEARCH FUNCTIONALITY ====================

// Function to filter items based on search
function filterItems(searchTerm) {
    if (!searchTerm) {
        // If search is empty, show all PDFs
        updatePDFsDisplay(currentMaterialPDFs, currentImpPDFs);
        return;
    }
    
    const filteredMaterials = currentMaterialPDFs.filter(pdf => 
        pdf.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
        pdf.displayName.toLowerCase().includes(searchTerm.toLowerCase())
    );
    
    const filteredImpMaterials = currentImpPDFs.filter(pdf => 
        pdf.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
        pdf.displayName.toLowerCase().includes(searchTerm.toLowerCase())
    );
    
    renderPDFCards(filteredMaterials, pdfGrid);
    renderPDFCards(filteredImpMaterials, impPdfGrid);
    renderPDFCards(filteredMaterials, pdfMiniView, true);
    renderPDFCards(filteredImpMaterials, impPdfMiniView, true);
    
    // Show no results message if nothing matches
    if (filteredMaterials.length === 0 && filteredImpMaterials.length === 0) {
        noResults.style.display = 'block';
    } else {
        noResults.style.display = 'none';
    }
}

// ==================== EVENT LISTENERS ====================

// Remove auto-show of admin login popup
window.addEventListener('load', function() {
    // Show welcome popup but NOT admin login
    welcomePopup.style.display = 'flex';
    adminLoginPopup.style.display = 'none';
    
    // Load real data from MongoDB
    loadPDFsFromDatabase();
    updateStatsCounts();
    
    // Increment website visits
    websiteVisits++;
    localStorage.setItem('websiteVisits', websiteVisits);
    updateAdminStats();
    
    // Increment server visits
    fetch('/api/visits/increment', { method: 'POST' }).catch(console.error);
});

// Close welcome popup
closePopup.addEventListener('click', function() {
    welcomePopup.style.display = 'none';
});

// Admin icon click - ONLY show admin login when admin icon is clicked
adminIcon.addEventListener('click', function() {
    adminLoginPopup.style.display = 'flex';
});

// Close admin login popup if user clicks outside
adminLoginPopup.addEventListener('click', function(e) {
    if (e.target === adminLoginPopup) {
        adminLoginPopup.style.display = 'none';
    }
});

// Escape key to close admin login
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && adminLoginPopup.style.display === 'flex') {
        adminLoginPopup.style.display = 'none';
    }
});

// Event listeners for buttons
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('btn-view') || e.target.parentElement.classList.contains('btn-view')) {
        const btn = e.target.classList.contains('btn-view') ? e.target : e.target.parentElement;
        const id = btn.getAttribute('data-id');
        const type = btn.getAttribute('data-type');
        openPDFViewer(id, type);
    }
    
    if (e.target.classList.contains('btn-download') || e.target.parentElement.classList.contains('btn-download')) {
        const btn = e.target.classList.contains('btn-download') ? e.target : e.target.parentElement;
        const id = btn.getAttribute('data-id');
        const type = btn.getAttribute('data-type');
        downloadPDF(id, type);
    }
});

// Event listeners for search
searchInput.addEventListener('input', function() {
    filterItems(this.value);
});

// Close viewers
closePdfViewer.addEventListener('click', function() {
    pdfViewerContainer.style.display = 'none';
    pdfFrame.src = '';
});

closeImageViewer.addEventListener('click', function() {
    imageViewerContainer.style.display = 'none';
    fullImage.src = '';
});

// Close viewers when clicking outside the content
pdfViewerContainer.addEventListener('click', function(e) {
    if (e.target === pdfViewerContainer) {
        pdfViewerContainer.style.display = 'none';
        pdfFrame.src = '';
    }
});

imageViewerContainer.addEventListener('click', function(e) {
    if (e.target === imageViewerContainer) {
        imageViewerContainer.style.display = 'none';
        fullImage.src = '';
    }
});

// View More/Less functionality
viewMorePdfsBtn.addEventListener('click', function() {
    if (pdfsVisible === 6) {
        pdfsVisible = currentMaterialPDFs.length;
        viewMorePdfsBtn.textContent = 'View Less';
    } else {
        pdfsVisible = 6;
        viewMorePdfsBtn.textContent = 'View More';
    }
    renderPDFCards(currentMaterialPDFs, pdfMiniView, true);
});

viewMoreImpPdfsBtn.addEventListener('click', function() {
    if (impPdfsVisible === 6) {
        impPdfsVisible = currentImpPDFs.length;
        viewMoreImpPdfsBtn.textContent = 'View Less';
    } else {
        impPdfsVisible = 6;
        viewMoreImpPdfsBtn.textContent = 'View More';
    }
    renderPDFCards(currentImpPDFs, impPdfMiniView, true);
});

// Mobile routine handling
routineImage.addEventListener('click', function() {
    if (window.innerWidth <= 768) {
        mobileRoutinePopup.style.display = 'flex';
    } else {
        imageViewerTitle.textContent = "Semester Routine 2023";
        fullImage.src = this.src;
        imageViewerContainer.style.display = 'block';
    }
});

mobileRoutineClose.addEventListener('click', function() {
    mobileRoutinePopup.style.display = 'none';
});

// Theme toggle
themeToggle.addEventListener('click', function() {
    document.body.classList.toggle('dark-mode');
    if (document.body.classList.contains('dark-mode')) {
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    } else {
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
    }
});

// Floating Action Button
fab.addEventListener('click', function() {
    quickActions.classList.toggle('show');
    if (quickActions.classList.contains('show')) {
        fab.innerHTML = '<i class="fas fa-times"></i>';
    } else {
        fab.innerHTML = '<i class="fas fa-plus"></i>';
    }
});

// Quick Actions
quickDownload.addEventListener('click', function() {
    showToast("Preparing download package...");
});

quickSearch.addEventListener('click', function() {
    searchInput.focus();
    quickActions.classList.remove('show');
    fab.innerHTML = '<i class="fas fa-plus"></i>';
});

quickRoutine.addEventListener('click', function() {
    if (window.innerWidth <= 768) {
        mobileRoutinePopup.style.display = 'flex';
    } else {
        imageViewerTitle.textContent = "Semester Routine 2023";
        fullImage.src = routineImage.src;
        imageViewerContainer.style.display = 'block';
    }
    quickActions.classList.remove('show');
    fab.innerHTML = '<i class="fas fa-plus"></i>';
});

// Download routine
downloadRoutine.addEventListener('click', function() {
    const link = document.createElement('a');
    link.href = 'sem.png';
    link.download = 'semester_routine.png';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    showToast("Semester routine downloaded successfully");
});

// Update progress (simulated)
function updateProgress() {
    const progress = Math.min(75, Math.floor((currentMaterialPDFs.length + currentImpPDFs.length) / 20 * 100));
    progressFill.style.width = `${progress}%`;
    progressPercent.textContent = `${progress}%`;
}

// Initialize progress bar
setInterval(updateProgress, 2000);
    </script>
</body>
</html>
